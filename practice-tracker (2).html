<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Practice Pro Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=DM+Mono:wght@500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f8f9fa; --surface: #ffffff; --border: #eef0f2;
  --text: #1a1c1e; --text-muted: #64748b;
  --primary: #2d6a4f; --primary-light: #d8f3dc;
  --danger: #ef4444; --warning: #f59e0b; --success: #10b981;
  --radius: 16px; --shadow: 0 10px 15px -3px rgba(0,0,0,0.05);
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'DM Sans', sans-serif; }
body { background: var(--bg); color: var(--text); margin: 0; padding-bottom: 90px; }

/* Dashboard Cards */
.stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 16px; }
.stat-card { background: var(--surface); padding: 16px; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--border); }
.stat-card label { font-size: 11px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
.stat-card .val { font-family: 'DM Mono', monospace; font-size: 20px; font-weight: 600; margin-top: 4px; }

/* Better Lists */
.list-section { padding: 0 16px; }
.item-row { background: var(--surface); padding: 12px 16px; border-radius: 12px; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; border: 1px solid var(--border); transition: 0.2s; }
.item-row:active { transform: scale(0.98); background: var(--bg); }
.item-info b { display: block; font-size: 15px; }
.item-info span { font-size: 12px; color: var(--text-muted); }

/* Sticky Log Bar */
.quick-log { position: fixed; bottom: 85px; right: 20px; z-index: 100; }
.fab { width: 56px; height: 56px; border-radius: 28px; background: var(--primary); color: white; border: none; font-size: 24px; box-shadow: 0 4px 12px rgba(45,106,79,0.3); cursor: pointer; }

/* Navigation */
.nav-bar { position: fixed; bottom: 0; width: 100%; background: var(--surface); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 10px 0 25px; }
.nav-item { border: none; background: none; color: var(--text-muted); display: flex; flex-direction: column; align-items: center; font-size: 10px; font-weight: 600; gap: 4px; }
.nav-item.active { color: var(--primary); }
.nav-item span { font-size: 20px; }

/* Badges */
.pill { padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 700; }
.pill-cash { background: #dbeafe; color: #1e40af; }
.pill-bank { background: #dcfce7; color: #166534; }

.toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #1a1c1e; color: white; padding: 12px 24px; border-radius: 30px; font-size: 13px; z-index: 9999; display: none; }
</style>
</head>
<body>

<div id="toast" class="toast"></div>

<div style="padding: 24px 16px 8px; display: flex; justify-content: space-between; align-items: center;">
    <h1 style="font-size: 22px; margin: 0;">Dashboard</h1>
    <div id="status" style="font-size: 10px; color: var(--success); font-weight: 700;">‚óè SYNCED</div>
</div>

<div id="content">
    <div id="tab-home" class="tab-page">
        <div class="stat-grid">
            <div class="stat-card" style="border-left: 4px solid var(--primary)">
                <label>Monthly Take-Home</label>
                <div class="val" id="net-earned">‚Ç™0</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid var(--warning)">
                <label>Pending Collection</label>
                <div class="val" id="net-pending">‚Ç™0</div>
            </div>
        </div>
        <div class="list-section">
            <h3 style="font-size: 13px; color: var(--text-muted); text-transform: uppercase;">Recent Sessions</h3>
            <div id="recent-sessions"></div>
        </div>
    </div>

    <div id="tab-clients" class="tab-page" style="display:none">
        <div style="padding: 16px;">
            <div class="stat-card">
                <label>Add New Client</label>
                <div style="display: flex; gap: 8px; margin-top: 10px;">
                    <input type="text" id="c-name" placeholder="Name" style="flex:2; padding: 8px; border-radius: 8px; border: 1px solid var(--border);">
                    <input type="number" id="c-rate" placeholder="Rate" style="flex:1; padding: 8px; border-radius: 8px; border: 1px solid var(--border);">
                    <button onclick="addClient()" class="btn" style="background: var(--primary); color: white; border: none; border-radius: 8px; padding: 0 16px;">+</button>
                </div>
                <select id="c-type" style="width:100%; margin-top:8px; padding: 8px; border-radius: 8px; border: 1px solid var(--border);">
                    <option value="cash">Cash Payment</option>
                    <option value="bank">Bank Transfer (VV)</option>
                </select>
            </div>
        </div>
        <div class="list-section" id="client-list"></div>
    </div>
</div>

<div class="quick-log">
    <button class="fab" onclick="showLogModal()">+</button>
</div>

<nav class="nav-bar">
    <button class="nav-item active" onclick="nav('home', this)"><span>üè†</span>Home</button>
    <button class="nav-item" onclick="nav('clients', this)"><span>üë§</span>Clients</button>
    <button class="nav-item" onclick="showLogModal()"><span>üìã</span>Log</button>
    <button class="nav-item" onclick="nav('records', this)"><span>üìä</span>Report</button>
</nav>

<script>
const VV_CUT = 0.85; // What you keep
let clients = [], sessions = [];
const sb = window.supabase.createClient('https://fxpaacqnsbnbzbcabpvi.supabase.co', 'sb_publishable_JTb6iSLPvZVAYhQELImNfQ_4bvD4-Hy');

async function loadData() {
    const { data: c } = await sb.from('clients').select('*').order('name');
    const { data: s } = await sb.from('sessions').select('*').order('date', {ascending: false});
    clients = c || [];
    sessions = s || [];
    render();
}

function nav(tab, el) {
    document.querySelectorAll('.tab-page').forEach(p => p.style.display = 'none');
    const target = document.getElementById('tab-' + tab);
    if(target) target.style.display = 'block';
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    el.classList.add('active');
}

function render() {
    // Dashboard Calcs
    let earned = 0, pending = 0;
    sessions.forEach(s => {
        const c = clients.find(cl => cl.id === s.client_id);
        if(!c) return;
        const net = Math.round(c.rate * VV_CUT);
        if(s.paid) earned += net;
        else if(s.status === 'happened') pending += net;
    });
    document.getElementById('net-earned').innerText = `‚Ç™${earned}`;
    document.getElementById('net-pending').innerText = `‚Ç™${pending}`;

    // Session List
    const sessionHTML = sessions.slice(0, 10).map(s => {
        const c = clients.find(cl => cl.id === s.client_id);
        return `
        <div class="item-row">
            <div class="item-info">
                <b>${c ? c.name : 'Unknown'}</b>
                <span>${new Date(s.date).toLocaleDateString('en-GB')}</span>
            </div>
            <div class="pill ${s.paid ? 'pill-bank' : 'pill-cash'}" style="background: ${s.paid ? '#dcfce7' : '#fee2e2'}">
                ${s.paid ? 'PAID' : 'DUE'}
            </div>
        </div>`;
    }).join('');
    document.getElementById('recent-sessions').innerHTML = sessionHTML;

    // Client List with Alphabetical Sort & Archive Status
    const clientHTML = clients.map(c => `
        <div class="item-row" style="${c.status === 'archived' ? 'opacity:0.5' : ''}">
            <div class="item-info">
                <b>${c.name}</b>
                <span>‚Ç™${c.rate} ¬∑ ${c.type}</span>
            </div>
            <button onclick="toggleClient('${c.id}', '${c.status}')" style="border:none; background:none; font-size:18px;">
                ${c.status === 'active' ? 'üìÇ' : '‚úÖ'}
            </button>
        </div>
    `).join('');
    document.getElementById('client-list').innerHTML = clientHTML;
}

async function addClient() {
    const name = document.getElementById('c-name').value;
    const rate = document.getElementById('c-rate').value;
    const type = document.getElementById('c-type').value;
    if(!name || !rate) return;
    await sb.from('clients').insert([{name, rate, type, status:'active'}]);
    toast("Client Added");
    loadData();
}

function toast(msg) {
    const t = document.getElementById('toast');
    t.innerText = msg; t.style.display = 'block';
    setTimeout(() => t.style.display = 'none', 2000);
}

window.onload = loadData;
</script>
</body>
</html>
